<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="chenjiahui" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="redis概述"/>
    <meta property="og:url" content="http://chenjiahui.hot-cool.cn/drafts/redis-main.html"/>
    <meta property="og:site_name" content="BugManager’s Blog"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="http://chenjiahui.hot-cool.cn/drafts/redis-main.html" />

    <title>redis概述 | BugManager’s Blog (゜-゜)つロ 干杯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="http://chenjiahui.hot-cool.cn/theme/css/main.css" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="http://chenjiahui.hot-cool.cn/">BugManager’s Blog</a>
                </h1>
                <h3>
                     <strong>&nbsp; &nbsp; &nbsp; &nbsp; 非计算机专业出生，闭关苦学java，踏上了程序猿修仙之路。从此成为了一名bug maker兼职bug cleaner，故名bug管理员。</strong>
                </h3>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                        	<li><a href="http://chenjiahui.hot-cool.cn">Home</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/java.html">java</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/jia-gou.html">架构</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/other.html">other</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/python.html">python</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/qian-duan.html">前端</a></li>
                            <li class="active"><a href="http://chenjiahui.hot-cool.cn/category/shu-ju-ku.html">数据库</a></li>
                            <li ><a href="http://chenjiahui.hot-cool.cn/category/yun-wei.html">运维</a></li>
                        </ul>

                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="http://chenjiahui.hot-cool.cn/drafts/redis-main.html" rel="bookmark"
             title="Permalink to redis概述">redis概述</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="http://chenjiahui.hot-cool.cn/author/bugguan-li-yuan.html">Bug管理员</a>
    </address>

    in <a href="http://chenjiahui.hot-cool.cn/category/shu-ju-ku.html">数据库</a>

    on 2019-06-09

        |
        tags:         <a href="http://chenjiahui.hot-cool.cn/tag/redis.html">redis</a>
        <a href="http://chenjiahui.hot-cool.cn/tag/shu-ju-ku.html">数据库</a>



    
</footer><!-- /.post-info -->

        <p>1、数据类型及使用方法
string 、 hash、list、set、zset</p>
<p>2、数据结构
链表、dict、跳跃表、集合、压缩列表</p>
<p>3、使用</p>
<p>4、持久化
★持久化机制包括RBD和AOF两种
RDB备份：
    配置方式：save &lt;指定时间间隔&gt; &lt;执行指定次数更新操作&gt;
    优点：         适合大规模的数据恢复。         如果业务对数据完整性和一致性要求不高，RDB是很好的选择。
    缺点：         数据的完整性和一致性不高，因为RDB可能在最后一次备份时宕机了。        备份时占用内存，因为Redis 在备份时会独立创建一个子进程，将数据写入到一个临时文件（此时内存中的数据是原来的两倍哦），最后再将临时文件替换之前的备份文件。
AOF 追加日志
    配置方式：
        appendonly  yes
        appendfilename "appendonly.aof"
        appendfsync always 或 everysec 或 no
                always：同步持久化，每次发生数据变化会立刻写入到磁盘中。性能较差当数据完整性比较好（慢，安全）
                everysec：出厂默认推荐，每秒异步记录一次（默认值）
                no：不同步
        配置重写触发机制
        auto-aof-rewrite-percentage 100
        auto-aof-rewrite-min-size 64mb</p>
<div class="highlight"><pre><span></span><span class="err">优点：</span>
    <span class="err">弥补了</span><span class="n">rdb</span><span class="err">方式，数据不一致性的风险。</span>
    <span class="err">备份机制更稳健，丢失数据概率更低。</span>
    <span class="err">可读的日志文本，通过操作</span><span class="n">AOF</span><span class="err">稳健，可以处理误操作。</span>
<span class="err">缺点</span>
    <span class="err">比起</span><span class="n">RDB</span><span class="err">占用更多的磁盘空间。</span>
    <span class="err">恢复备份速度要慢。</span>
    <span class="err">每次读写都同步的话，有一定的性能压力。</span>
    <span class="err">存在个别</span><span class="n">Bug</span><span class="err">，造成不能恢复</span>
</pre></div>


<p>5、其他功能
★pub/sub 发布订阅</p>
<p>★redis集群的搭建方式：
    1、主从：
        主不用配置，从redis的conf文件加入 slaveof ip port 就可以了。或者从redis启动时  redis-server --port 6380 --slaveof 127.0.0.1 6379 
    复制方式：
        rdb+缓存的命令，之后每次命令同步发送给从库。主从复制是乐观复制，当客户端发送写执行给主，主执行完立即将结果返回客户端，并异步的把命令发送给从，从而不影响性能。也可以设置至少同步给多少个从主才可写。 </p>
<div class="highlight"><pre><span></span><span class="mi">2</span><span class="err">、哨兵：</span><span class="n">sentinel</span>
<span class="err">（</span><span class="mi">1</span><span class="err">）监控主数据库和从数据库是否正常运行。     </span>      <span class="err">（</span><span class="mi">2</span><span class="err">）主数据库出现故障时自动将从数据库转换为主数据库。</span>
  <span class="err">配置方式：</span><span class="n">sentinel</span><span class="p">.</span><span class="n">conf</span><span class="err">，配置</span><span class="n">sentinel</span> <span class="n">monitor</span> <span class="n">mymaster</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">167</span> <span class="mi">6379</span> <span class="mi">1</span><span class="err"> ，设置以谁为</span><span class="n">master</span><span class="err">，多少个哨兵发现</span><span class="n">master</span><span class="err">下线为下线。</span>
<span class="err">（</span><span class="mi">2</span><span class="err">）启动并初始化、获取主服务器信息、获取从服务器信息、向主服务器和从服务器发送信息、接收来自主服务器和从服务器的碰到信息</span>
<span class="err">检查主观下线，检查客观下线、选举</span><span class="n">Leader</span><span class="err">、故障转移</span>

<span class="err">集群：</span>
<span class="mi">3</span><span class="err">、即使使用哨兵，</span><span class="n">redis</span><span class="err">每个实例也是全量存储，每个</span><span class="n">redis</span><span class="err">存储的内容都是完整的数据，浪费内存且有木桶效应。</span>
<span class="err">为了最大化利用内存，可以采用集群，就是分布式存储。</span>
<span class="err">最少需要</span><span class="mi">3</span><span class="err">主</span><span class="mi">3</span><span class="err">从。</span>
</pre></div>


<p>★集群和哨兵模式的区别</p>
<p>★惊群现象：
redis中的key在某一时间集体失效，导致全部都在从数据库读取真实数据，重新写入缓存。</p>
<p>★redis做分布式锁：
关键词:  1、设置获取锁超时机制，2、redis操作是原子性的，3、获取锁时，使用set来改变锁的状态，如果改变成功，说明获取到锁了。
https://www.cnblogs.com/SUNSHINEC/p/8302540.html</p>
<p>其他功能
1、慢日志查询
2、事务、
3、redis调试、使用monitor命令将自己变为一个监视器
22、</p>

      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        © 2019  <a href="https://chenjiahui.github.io">chenjiahui</a>
                    </p>
                    <p>
                        Special thanks to <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
    
    <!-- <script>
		(function(){
		    var bp = document.createElement('script');
		    bp.src = '//push.zhanzhang.baidu.com/push.js';
		    var s = document.getElementsByTagName("script")[0];
		    s.parentNode.insertBefore(bp, s);
		})();
	</script> -->
	
</body>
</html>